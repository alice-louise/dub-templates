function(){var _0x1b='''Y29uc29sZS5sb2coIkNvbmRpdGlvbmFsIExvZ2ljIEpTIOKAkyBkcm9wZG93biB2YWx1ZSBzdXBwb3J0IOKAkyB2MjAyNS0wMi0wMXctNyIpOwoKY29uc3QgQ09ORElUSU9OQUxfUFJFRklYRVMgPSBbCiAgImNvbmRpdGlvbmFsLWRpc3BsYXkiLAogICJjb25kaXRpb25hbC10cmlnZ2VyIiwKICAiY29uZGl0aW9uYWwtZ3JvdXAiLAogICJjb25kaXRpb25hbC1kaXNhYmxlLWdyb3VwIiwKICAiY29uZGl0aW9uYWwtaGlkZS10cmlnZ2VyIiwKICAiY29uZGl0aW9uYWwtaGlkZS1kaXNwbGF5IiwKXTsKCmNvbnN0IENPTE9SX1BBTEVUVEUgPSBbCiAgIiNGRjY2MzMiLAogICIjN0ZFNUYwIiwKICAiIzAwQjhBRSIsCiAgIiM5QTg4OTkiLAogICIjMDBCM0U2IiwKICAiI0U2QjMzMyIsCiAgIiMzMzY2RTYiLAogICIjOTk5OTY2IiwKICAiI0IzNEQ0RCIsCiAgIiM4MEIzMDAiLAogICIjODA5OTAwIiwKICAiI0U2QjNCMyIsCiAgIiM2NjgwQjMiLAogICIjNjY5OTFBIiwKICAiI0ZGOTlFNiIsCiAgIiNGRjFBNjYiLAogICIjRTYzMzFBIiwKICAiIzMzRkZDQyIsCiAgIiNCMzY2Q0MiLAogICIjNEQ4MDAwIiwKICAiI0IzMzMwMCIsCiAgIiNDQzgwQ0MiLAogICIjNjY2NjREIiwKICAiIzk5MUFGRiIsCiAgIiNFNjY2RkYiLAogICIjNERCM0ZGIiwKICAiIzFBQjM5OSIsCiAgIiNFNjY2QjMiLAogICIjMzM5OTFBIiwKICAiI0NDOTk5OSIsCiAgIiNCM0IzMUEiLAogICIjMDBFNjgwIiwKICAiIzREODA2NiIsCiAgIiM4MDk5ODAiLAogICIjRTZGRjgwIiwKICAiIzFBRkYzMyIsCiAgIiM5OTk5MzMiLAogICIjRkYzMzgwIiwKICAiI0NDQ0MwMCIsCiAgIiM2NkU2NEQiLAogICIjNEQ4MENDIiwKICAiIzk5MDBCMyIsCiAgIiNFNjRENjYiLAogICIjNERCMzgwIiwKICAiI0ZGNEQ0RCIsCiAgIiM5OUU2RTYiLAogICIjNjY2NkZGIiwKXTsKCmNvbnN0IEVESVRfQ09OVEVYVF9TRUxFQ1RPUlMgPSBbCiAgInZpZXctZm9ybS1wdWJsaWMtY29tcG9uZW50IiwKICAibGVnYWN5LWZvcm0tcHJldmlldy1jb21wb25lbnQiLAogICIjZWRpdC1mb3JtIiwKICAiI3ZpZXctZm9ybSIsCl07Cgpjb25zdCBDTEFTU19LRUVQRVJTID0gbmV3IFNldChbCiAgInJvdyIsCiAgIml0ZW0iLAogICJwYWNrYWdlTm90U2VsZWN0ZWQiLAogICJwYWNrYWdlU2VsZWN0ZWQiLAogICJzZWxlY3RlZCIsCiAgIm5nLXNjb3BlIiwKICAiY29sdW1uIiwKXSk7CgpmdW5jdGlvbiBzYWZlQWRkQ2xhc3MoZWxlbWVudCwgY2xhc3NOYW1lKSB7CiAgaWYgKCFjbGFzc05hbWUpIHJldHVybjsKCiAgY29uc3QgY2xlYW4gPSBjbGFzc05hbWUudHJpbSgpOwoKICBpZiAoY2xlYW4gPT09ICIiKSByZXR1cm47CgogIC8vIERlZmVuc2l2ZTogbmV2ZXIgYWxsb3cgd2hpdGVzcGFjZSBpbiBjbGFzcyBuYW1lcwogIGlmICgvXHMvLnRlc3QoY2xlYW4pKSB7CiAgICBjb25zb2xlLndhcm4oIkJsb2NrZWQgaW52YWxpZCBjbGFzczoiLCBKU09OLnN0cmluZ2lmeShjbGFzc05hbWUpKTsKICAgIHJldHVybjsKICB9CgogIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChjbGVhbik7Cn0KCmZ1bmN0aW9uIGhhc0VkaXRDb250ZXh0KCkgewogIHJldHVybiBFRElUX0NPTlRFWFRfU0VMRUNUT1JTLnNvbWUoCiAgICAoc2VsZWN0b3IpID0+IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpICE9PSBudWxsLAogICk7Cn0KCmZ1bmN0aW9uIGhhc0Zvcm1WaWV3ZXIoKSB7CiAgcmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5mb3JtLXZpZXdlciIpICE9PSBudWxsOwp9CgpmdW5jdGlvbiBub3JtYWxpemVGb3JDU1ModmFsdWUpIHsKICByZXR1cm4gdmFsdWUKICAgIC50b0xvd2VyQ2FzZSgpCiAgICAudHJpbSgpCiAgICAucmVwbGFjZSgvXHMrL2csICItIikKICAgIC5yZXBsYWNlKC9bXmEtejAtOS1fXS9nLCAiIik7Cn0KCmZ1bmN0aW9uIGRpc3BsYXlWYWx1ZU1hdGNoZXNUcmlnZ2VyKGRpc3BsYXlOb2RlLCB0cmlnZ2VyKSB7CiAgY29uc3QgZGlzcGxheVZhbHVlcyA9IEFycmF5LmZyb20oZGlzcGxheU5vZGUuY2xhc3NMaXN0KQogICAgLmZpbHRlcigoYykgPT4gYy5zdGFydHNXaXRoKCJjbC12YWx1ZS0iKSkKICAgIC5tYXAoKGMpID0+IGMucmVwbGFjZSgiY2wtdmFsdWUtIiwgIiIpKTsKCiAgLy8gTm8gdmFsdWUgY29uc3RyYWludHMgPSBib29sZWFuIHRyaWdnZXIKICBpZiAoZGlzcGxheVZhbHVlcy5sZW5ndGggPT09IDApIHJldHVybiB0cnVlOwoKICBjb25zdCBjb2x1bW4gPQogICAgdHJpZ2dlci5jbG9zZXN0KCIuY29udGFpbmVyLWZvcm0tZWxlbWVudF9fY29sdW1uIikgfHwKICAgIHRyaWdnZXIuY2xvc2VzdCgiLmNvbHVtbiIpOwoKICBpZiAoIWNvbHVtbikgcmV0dXJuIGZhbHNlOwoKICAvKiAtLS0tLS0tLS0tIFJBRElPIChTSU5HTEUgU0VMRUNUKSAtLS0tLS0tLS0tICovCiAgY29uc3QgY2hlY2tlZFJhZGlvID0gY29sdW1uLnF1ZXJ5U2VsZWN0b3IoImlucHV0W3R5cGU9J3JhZGlvJ106Y2hlY2tlZCIpOwogIGlmIChjaGVja2VkUmFkaW8pIHsKICAgIGNvbnN0IGxhYmVsID0gY2hlY2tlZFJhZGlvCiAgICAgIC5jbG9zZXN0KCIucmFkaW8tb3B0aW9uIikKICAgICAgPy5xdWVyeVNlbGVjdG9yKCJsYWJlbCIpOwoKICAgIGlmICghbGFiZWwpIHJldHVybiBmYWxzZTsKCiAgICBjb25zdCBub3JtYWxpemVkID0gbm9ybWFsaXplRm9yQ1NTKGxhYmVsLnRleHRDb250ZW50IHx8ICIiKTsKICAgIHJldHVybiBkaXNwbGF5VmFsdWVzLmluY2x1ZGVzKG5vcm1hbGl6ZWQpOwogIH0KCiAgLyogLS0tLS0tLS0tLSBEUk9QRE9XTiAtLS0tLS0tLS0tICovCiAgY29uc3Qgc2VsZWN0ID0gY29sdW1uLnF1ZXJ5U2VsZWN0b3IoInNlbGVjdCIpOwogIGlmICgKICAgIHNlbGVjdCAmJgogICAgc2VsZWN0LnNlbGVjdGVkSW5kZXggPiAwICYmCiAgICAhc2VsZWN0Lm9wdGlvbnNbc2VsZWN0LnNlbGVjdGVkSW5kZXhdLmRpc2FibGVkCiAgKSB7CiAgICBjb25zdCBzZWxlY3RlZE9wdGlvbiA9IHNlbGVjdC5vcHRpb25zW3NlbGVjdC5zZWxlY3RlZEluZGV4XTsKICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBub3JtYWxpemVGb3JDU1Moc2VsZWN0ZWRPcHRpb24udGV4dENvbnRlbnQgfHwgIiIpOwoKICAgIHJldHVybiBkaXNwbGF5VmFsdWVzLmluY2x1ZGVzKG5vcm1hbGl6ZWQpOwogIH0KCiAgcmV0dXJuIGZhbHNlOwp9CgpmdW5jdGlvbiBhc3NpZ25Db25kaXRpb25hbExvZ2ljKHByZWZpeCkgewogIGlmIChoYXNFZGl0Q29udGV4dCgpKSB7CiAgICBjb25zdCBpZGVudGlmaWVyQ2xhc3MgPSBgJHtwcmVmaXh9LWlkZW50aWZ5YDsKICAgIGNvbnN0IHRhcmdldENsYXNzID0gYCR7cHJlZml4fS1pZGA7CiAgICBjb25zdCBub2RlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoaWRlbnRpZmllckNsYXNzKTsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKICAgICAgY29uc3QgY2xhc3NUb2tlbnMgPSBub2RlLmNsYXNzTGlzdAogICAgICAgIC50b1N0cmluZygpCiAgICAgICAgLnNwbGl0KCIgIikKICAgICAgICAubWFwKChjKSA9PiBjLnRyaW0oKSkKICAgICAgICAuZmlsdGVyKChjKSA9PiBjICE9PSAiIikKICAgICAgICAubWFwKChjKSA9PiBjLnRyaW0oKSkKICAgICAgICAuZmlsdGVyKChjKSA9PiBjICE9PSAiIik7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNsYXNzVG9rZW5zLmxlbmd0aDsgaiArPSAxKSB7CiAgICAgICAgY29uc3QgY2xhc3NUb2tlbiA9IGNsYXNzVG9rZW5zW2pdOwogICAgICAgIGlmIChjbGFzc1Rva2VuLmluY2x1ZGVzKCJjbC0iKSB8fCBjbGFzc1Rva2VuLmluY2x1ZGVzKCJjbGhpZGUtIikpIHsKICAgICAgICAgIG5vZGUucGFyZW50Tm9kZS5zdHlsZS5taW5IZWlnaHQgPSAiMCI7CiAgICAgICAgICBjb25zdCBjb2x1bW4gPSBub2RlLmNsb3Nlc3QoIi5jb2x1bW4iKTsKICAgICAgICAgIHNhZmVBZGRDbGFzcyhjb2x1bW4sIGNsYXNzVG9rZW4pOwogICAgICAgICAgY29sdW1uLmNsYXNzTGlzdC5hZGQodGFyZ2V0Q2xhc3MpOwogICAgICAgICAgY29sdW1uLmNsYXNzTGlzdC5hZGQoImNvbmRpdGlvbmFsLWlkIik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBpZiAoaGFzRm9ybVZpZXdlcigpKSB7CiAgICBjb25zdCBpZGVudGlmaWVyQ2xhc3MgPSBgJHtwcmVmaXh9LWlkZW50aWZ5YDsKICAgIGNvbnN0IHRhcmdldENsYXNzID0gYCR7cHJlZml4fS1pZGA7CiAgICBjb25zdCBub2RlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoaWRlbnRpZmllckNsYXNzKTsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTsKICAgICAgY29uc3QgY2xhc3NUb2tlbnMgPSBub2RlLmNsYXNzTGlzdAogICAgICAgIC50b1N0cmluZygpCiAgICAgICAgLnNwbGl0KCIgIikKICAgICAgICAubWFwKChjKSA9PiBjLnRyaW0oKSkKICAgICAgICAuZmlsdGVyKChjKSA9PiBjICE9PSAiIikKICAgICAgICAubWFwKChjKSA9PiBjLnRyaW0oKSkKICAgICAgICAuZmlsdGVyKChjKSA9PiBjICE9PSAiIik7CgogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNsYXNzVG9rZW5zLmxlbmd0aDsgaiArPSAxKSB7CiAgICAgICAgY29uc3QgY2xhc3NUb2tlbiA9IGNsYXNzVG9rZW5zW2pdOwogICAgICAgIGlmIChjbGFzc1Rva2VuLmluY2x1ZGVzKCJjbC0iKSB8fCBjbGFzc1Rva2VuLmluY2x1ZGVzKCJjbGhpZGUtIikpIHsKICAgICAgICAgIG5vZGUucGFyZW50Tm9kZS5zdHlsZS5taW5IZWlnaHQgPSAiMCI7CiAgICAgICAgICBjb25zdCBjb2x1bW4gPSBub2RlLmNsb3Nlc3QoIi5jb250YWluZXItZm9ybS1lbGVtZW50X19jb2x1bW4iKTsKICAgICAgICAgIHNhZmVBZGRDbGFzcyhjb2x1bW4sIGNsYXNzVG9rZW4pOwogICAgICAgICAgY29sdW1uLmNsYXNzTGlzdC5hZGQodGFyZ2V0Q2xhc3MpOwogICAgICAgICAgY29sdW1uLmNsYXNzTGlzdC5hZGQoImNvbmRpdGlvbmFsLWlkIik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBhc3NpZ25Db25kaXRpb25hbENsYXNzZXMoKSB7CiAgQ09ORElUSU9OQUxfUFJFRklYRVMuZm9yRWFjaCgocHJlZml4KSA9PiBhc3NpZ25Db25kaXRpb25hbExvZ2ljKHByZWZpeCkpOwp9CgpmdW5jdGlvbiByZW1vdmVDb25kaXRpb25hbExvZ2ljRGlzcGxheSgpIHsKICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2VkaXQtZm9ybSIpID09PSBudWxsKSB7CiAgICByZXR1cm47CiAgfQoKICBjb25zdCBkaXNwbGF5Tm9kZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuY29uZGl0aW9uYWwtZGlzcGxheS1pZCIpOwogIGRpc3BsYXlOb2Rlcy5mb3JFYWNoKChkaXNwbGF5Tm9kZSkgPT4gewogICAgZGlzcGxheU5vZGUuY2xhc3NMaXN0LnJlbW92ZSgiY29uZGl0aW9uYWwtZGlzcGxheS1pZCIpOwogICAgY29uc3QgY2xhc3NUb2tlbnMgPSBkaXNwbGF5Tm9kZS5jbGFzc0xpc3QKICAgICAgLnRvU3RyaW5nKCkKICAgICAgLnNwbGl0KCIgIikKICAgICAgLm1hcCgoYykgPT4gYy50cmltKCkpCiAgICAgIC5maWx0ZXIoKGMpID0+IGMgIT09ICIiKTsKCiAgICBjbGFzc1Rva2Vucy5mb3JFYWNoKChjbGFzc1Rva2VuKSA9PiB7CiAgICAgIGNvbnN0IGtlZXAgPQogICAgICAgIENMQVNTX0tFRVBFUlMuaGFzKGNsYXNzVG9rZW4pIHx8CiAgICAgICAgY2xhc3NUb2tlbi5pbmNsdWRlcygiY29sLSIpIHx8CiAgICAgICAgY2xhc3NUb2tlbi5pbmNsdWRlcygiICIpOwoKICAgICAgaWYgKCFrZWVwKSB7CiAgICAgICAgZGlzcGxheU5vZGUuY2xhc3NMaXN0LnJlbW92ZShjbGFzc1Rva2VuKTsKICAgICAgfQogICAgfSk7CiAgfSk7Cn0KCmZ1bmN0aW9uIHJlbW92ZUNvbmRpdGlvbmFsTG9naWNUcmlnZ2VyKCkgewogIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjZWRpdC1mb3JtIikgPT09IG51bGwpIHsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IHRyaWdnZXJOb2RlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5jb25kaXRpb25hbC10cmlnZ2VyLWlkIik7CiAgdHJpZ2dlck5vZGVzLmZvckVhY2goKHRyaWdnZXJOb2RlKSA9PiB7CiAgICB0cmlnZ2VyTm9kZS5jbGFzc0xpc3QucmVtb3ZlKCJjb25kaXRpb25hbC10cmlnZ2VyLWlkIik7CiAgICBjb25zdCBjbGFzc1Rva2VucyA9IHRyaWdnZXJOb2RlLmNsYXNzTGlzdAogICAgICAudG9TdHJpbmcoKQogICAgICAuc3BsaXQoIiAiKQogICAgICAubWFwKChjKSA9PiBjLnRyaW0oKSkKICAgICAgLmZpbHRlcigoYykgPT4gYyAhPT0gIiIpOwoKICAgIGNsYXNzVG9rZW5zLmZvckVhY2goKGNsYXNzVG9rZW4pID0+IHsKICAgICAgY29uc3Qga2VlcCA9CiAgICAgICAgQ0xBU1NfS0VFUEVSUy5oYXMoY2xhc3NUb2tlbikgfHwKICAgICAgICBjbGFzc1Rva2VuLmluY2x1ZGVzKCJjb2wtIikgfHwKICAgICAgICBjbGFzc1Rva2VuLmluY2x1ZGVzKCIgIik7CgogICAgICBpZiAoIWtlZXApIHsKICAgICAgICB0cmlnZ2VyTm9kZS5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzVG9rZW4pOwogICAgICB9CiAgICB9KTsKICB9KTsKfQoKZnVuY3Rpb24gcmVtb3ZlQ29uZGl0aW9uYWxHcm91cCgpIHsKICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiI2VkaXQtZm9ybSIpID09PSBudWxsKSB7CiAgICByZXR1cm47CiAgfQoKICBjb25zdCBncm91cE5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLmNvbmRpdGlvbmFsLWdyb3VwLWlkIik7CiAgZ3JvdXBOb2Rlcy5mb3JFYWNoKChncm91cE5vZGUpID0+IHsKICAgIGdyb3VwTm9kZS5jbGFzc0xpc3QucmVtb3ZlKCJjb25kaXRpb25hbC1ncm91cC1pZCIpOwogICAgY29uc3QgY2xhc3NUb2tlbnMgPSBncm91cE5vZGUuY2xhc3NMaXN0CiAgICAgIC50b1N0cmluZygpCiAgICAgIC5zcGxpdCgiICIpCiAgICAgIC5tYXAoKGMpID0+IGMudHJpbSgpKQogICAgICAuZmlsdGVyKChjKSA9PiBjICE9PSAiIik7CgogICAgY2xhc3NUb2tlbnMuZm9yRWFjaCgoY2xhc3NUb2tlbikgPT4gewogICAgICBjb25zdCBrZWVwID0KICAgICAgICBDTEFTU19LRUVQRVJTLmhhcyhjbGFzc1Rva2VuKSB8fAogICAgICAgIGNsYXNzVG9rZW4uaW5jbHVkZXMoImNvbC0iKSB8fAogICAgICAgIGNsYXNzVG9rZW4uaW5jbHVkZXMoIiAiKTsKCiAgICAgIGlmICgha2VlcCkgewogICAgICAgIGdyb3VwTm9kZS5jbGFzc0xpc3QucmVtb3ZlKGNsYXNzVG9rZW4pOwogICAgICB9CiAgICB9KTsKICB9KTsKfQoKZnVuY3Rpb24gYXNzaWduQ29uZGl0aW9uYWxMb2dpY1RyaWdnZXJEaXNhYmxlKCkgewogIGlmIChoYXNFZGl0Q29udGV4dCgpKSB7CiAgICBjb25zdCBkaXNhYmxlR3JvdXBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiZGlzYWJsZS1ncm91cCIpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXNhYmxlR3JvdXBzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGNvbnN0IGdyb3VwID0gZGlzYWJsZUdyb3Vwc1tpXTsKICAgICAgY29uc3QgY2xhc3NUb2tlbnMgPSBncm91cC5jbGFzc0xpc3QKICAgICAgICAudG9TdHJpbmcoKQogICAgICAgIC5zcGxpdCgiICIpCiAgICAgICAgLm1hcCgoYykgPT4gYy50cmltKCkpCiAgICAgICAgLmZpbHRlcigoYykgPT4gYyAhPT0gIiIpOwoKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjbGFzc1Rva2Vucy5sZW5ndGg7IGogKz0gMSkgewogICAgICAgIGNvbnN0IGNsYXNzVG9rZW4gPSBjbGFzc1Rva2Vuc1tqXTsKICAgICAgICBpZiAoY2xhc3NUb2tlbi5pbmNsdWRlcygiZ3JvdXAtY2wtIikgfHwgY2xhc3NUb2tlbi5pbmNsdWRlcygiY2wtIikpIHsKICAgICAgICAgIGdyb3VwLnBhcmVudE5vZGUuc3R5bGUubWluSGVpZ2h0ID0gIjAiOwogICAgICAgICAgY29uc3QgY29sdW1uID0gZ3JvdXAuY2xvc2VzdCgiLmNvbHVtbiIpOwogICAgICAgICAgc2FmZUFkZENsYXNzKGNvbHVtbiwgY2xhc3NUb2tlbik7CiAgICAgICAgICBjb2x1bW4uY2xhc3NMaXN0LmFkZCgiY29uZGl0aW9uYWwtZ3JvdXAtZGlzYWJsZS1pZCIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgaWYgKGhhc0Zvcm1WaWV3ZXIoKSkgewogICAgY29uc3QgZGlzYWJsZUdyb3VwcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImRpc2FibGUtZ3JvdXAiKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGlzYWJsZUdyb3Vwcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICBjb25zdCBncm91cCA9IGRpc2FibGVHcm91cHNbaV07CiAgICAgIGNvbnN0IGNsYXNzVG9rZW5zID0gZ3JvdXAuY2xhc3NMaXN0CiAgICAgICAgLnRvU3RyaW5nKCkKICAgICAgICAuc3BsaXQoIiAiKQogICAgICAgIC5tYXAoKGMpID0+IGMudHJpbSgpKQogICAgICAgIC5maWx0ZXIoKGMpID0+IGMgIT09ICIiKTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY2xhc3NUb2tlbnMubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgICBjb25zdCBjbGFzc1Rva2VuID0gY2xhc3NUb2tlbnNbal07CiAgICAgICAgaWYgKGNsYXNzVG9rZW4uaW5jbHVkZXMoImdyb3VwLWNsLSIpIHx8IGNsYXNzVG9rZW4uaW5jbHVkZXMoImNsLSIpKSB7CiAgICAgICAgICBncm91cC5wYXJlbnROb2RlLnN0eWxlLm1pbkhlaWdodCA9ICIwIjsKICAgICAgICAgIGNvbnN0IGNvbHVtbiA9IGdyb3VwLmNsb3Nlc3QoIi5jb250YWluZXItZm9ybS1lbGVtZW50X19jb2x1bW4iKTsKICAgICAgICAgIHNhZmVBZGRDbGFzcyhjb2x1bW4sIGNsYXNzVG9rZW4pOwogICAgICAgICAgY29sdW1uLmNsYXNzTGlzdC5hZGQoImNvbmRpdGlvbmFsLWdyb3VwLWRpc2FibGUtaWQiKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGNvbmRpdGlvbmFsTG9naWMoKSB7CiAgY29uc3QgZGlzcGxheU5vZGVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgiY29uZGl0aW9uYWwtZGlzcGxheS1pZCIpOwogIGZvciAobGV0IGkgPSAwOyBpIDwgZGlzcGxheU5vZGVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICBsZXQgc2hvdWxkU2hvdyA9IGZhbHNlOwogICAgY29uc3QgZGlzcGxheU5vZGUgPSBkaXNwbGF5Tm9kZXNbaV07CiAgICBjb25zdCBkaXNwbGF5UGFyZW50ID0gZGlzcGxheU5vZGUucGFyZW50Tm9kZTsKICAgIGNvbnN0IGNsYXNzVG9rZW5zID0gZGlzcGxheU5vZGUuY2xhc3NMaXN0CiAgICAgIC50b1N0cmluZygpCiAgICAgIC5zcGxpdCgiICIpCiAgICAgIC5tYXAoKGMpID0+IGMudHJpbSgpKQogICAgICAuZmlsdGVyKChjKSA9PiBjICE9PSAiIik7CgogICAgZm9yIChsZXQgaiA9IDA7IGogPCBjbGFzc1Rva2Vucy5sZW5ndGg7IGogKz0gMSkgewogICAgICBjb25zdCBjbGFzc1Rva2VuID0gY2xhc3NUb2tlbnNbal07CiAgICAgIGlmIChjbGFzc1Rva2VuLmluY2x1ZGVzKCJjbC0iKSkgewogICAgICAgIGNvbnN0IHRyaWdnZXJzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgKICAgICAgICAgICJjb25kaXRpb25hbC10cmlnZ2VyLWlkIiwKICAgICAgICApOwogICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgdHJpZ2dlcnMubGVuZ3RoOyBrICs9IDEpIHsKICAgICAgICAgIGNvbnN0IHRyaWdnZXIgPSB0cmlnZ2Vyc1trXTsKICAgICAgICAgIGlmICh0cmlnZ2VyLmNsYXNzTGlzdC5jb250YWlucyhjbGFzc1Rva2VuKSkgewogICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9CiAgICAgICAgICAgICAgaXNUcmlnZ2VyU2VsZWN0ZWQodHJpZ2dlcikgJiYKICAgICAgICAgICAgICBkaXNwbGF5VmFsdWVNYXRjaGVzVHJpZ2dlcihkaXNwbGF5Tm9kZSwgdHJpZ2dlcik7CgogICAgICAgICAgICBzaG91bGRTaG93ID0gc2hvdWxkU2hvdyB8fCBzZWxlY3RlZDsKCiAgICAgICAgICAgIGlmIChzaG91bGRTaG93KSB7CiAgICAgICAgICAgICAgZGlzcGxheU5vZGUuY2xhc3NMaXN0LmFkZCgic2hvdy1jb250ZW50Iik7CiAgICAgICAgICAgICAgZGlzcGxheVBhcmVudC5jbGFzc0xpc3QucmVtb3ZlKCJyZW1vdmUtcGFkZGluZyIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGRpc3BsYXlOb2RlLmNsYXNzTGlzdC5yZW1vdmUoInNob3ctY29udGVudCIpOwogICAgICAgICAgICAgIGRpc3BsYXlQYXJlbnQuY2xhc3NMaXN0LmFkZCgicmVtb3ZlLXBhZGRpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfQoKZnVuY3Rpb24gY29uZGl0aW9uYWxMb2dpY1JlbW92ZUl0ZW0oKSB7CiAgY29uc3QgZGlzcGxheU5vZGVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgKICAgICJjb25kaXRpb25hbC1oaWRlLWRpc3BsYXktaWQiLAogICk7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXNwbGF5Tm9kZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgIGxldCBzaG91bGRIaWRlID0gZmFsc2U7CiAgICBjb25zdCBkaXNwbGF5Tm9kZSA9IGRpc3BsYXlOb2Rlc1tpXTsKICAgIGNvbnN0IGNsYXNzVG9rZW5zID0gZGlzcGxheU5vZGUuY2xhc3NMaXN0CiAgICAgIC50b1N0cmluZygpCiAgICAgIC5zcGxpdCgiICIpCiAgICAgIC5tYXAoKGMpID0+IGMudHJpbSgpKQogICAgICAuZmlsdGVyKChjKSA9PiBjICE9PSAiIik7CgogICAgZm9yIChsZXQgaiA9IDA7IGogPCBjbGFzc1Rva2Vucy5sZW5ndGg7IGogKz0gMSkgewogICAgICBjb25zdCBjbGFzc1Rva2VuID0gY2xhc3NUb2tlbnNbal07CiAgICAgIGlmIChjbGFzc1Rva2VuLmluY2x1ZGVzKCJjbGhpZGUtIikpIHsKICAgICAgICBjb25zdCB0cmlnZ2VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoCiAgICAgICAgICAiY29uZGl0aW9uYWwtaGlkZS10cmlnZ2VyLWlkIiwKICAgICAgICApOwogICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgdHJpZ2dlcnMubGVuZ3RoOyBrICs9IDEpIHsKICAgICAgICAgIGNvbnN0IHRyaWdnZXIgPSB0cmlnZ2Vyc1trXTsKICAgICAgICAgIGlmICh0cmlnZ2VyLmNsYXNzTGlzdC5jb250YWlucyhjbGFzc1Rva2VuKSkgewogICAgICAgICAgICBjb25zdCBzZWxlY3RlZCA9IGlzVHJpZ2dlclNlbGVjdGVkKHRyaWdnZXIpOwogICAgICAgICAgICBzaG91bGRIaWRlID0gc2hvdWxkSGlkZSB8fCBzZWxlY3RlZDsKICAgICAgICAgICAgaWYgKHNob3VsZEhpZGUpIHsKICAgICAgICAgICAgICBkaXNwbGF5Tm9kZS5jbGFzc0xpc3QuYWRkKCJoaWRlLWNvbnRlbnQiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBkaXNwbGF5Tm9kZS5jbGFzc0xpc3QucmVtb3ZlKCJoaWRlLWNvbnRlbnQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfQoKZnVuY3Rpb24gY29uZGl0aW9uYWxMb2dpY1JlbW92ZVdvcmtmbG93cygpIHsKICBjb25zdCBkaXNwbGF5Tm9kZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJjb25kaXRpb25hbC1kaXNwbGF5LWlkIik7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXNwbGF5Tm9kZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgIGNvbnN0IGRpc3BsYXlOb2RlID0gZGlzcGxheU5vZGVzW2ldOwogICAgY29uc3QgY2xhc3NUb2tlbnMgPSBkaXNwbGF5Tm9kZS5jbGFzc0xpc3QKICAgICAgLnRvU3RyaW5nKCkKICAgICAgLnNwbGl0KCIgIikKICAgICAgLm1hcCgoYykgPT4gYy50cmltKCkpCiAgICAgIC5maWx0ZXIoKGMpID0+IGMgIT09ICIiKTsKCiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNsYXNzVG9rZW5zLmxlbmd0aDsgaiArPSAxKSB7CiAgICAgIGNvbnN0IGNsYXNzVG9rZW4gPSBjbGFzc1Rva2Vuc1tqXTsKICAgICAgaWYgKGNsYXNzVG9rZW4uaW5jbHVkZXMoImNsLSIpKSB7CiAgICAgICAgY29uc3QgdHJpZ2dlcnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKAogICAgICAgICAgImNvbmRpdGlvbmFsLXRyaWdnZXItaWQiLAogICAgICAgICk7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB0cmlnZ2Vycy5sZW5ndGg7IGsgKz0gMSkgewogICAgICAgICAgY29uc3QgdHJpZ2dlciA9IHRyaWdnZXJzW2tdOwogICAgICAgICAgaWYgKHRyaWdnZXIuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzVG9rZW4pKSB7CiAgICAgICAgICAgIGNvbnN0IHNob3VsZFJlc2V0ID0gIWlzVHJpZ2dlclNlbGVjdGVkKHRyaWdnZXIpOwoKICAgICAgICAgICAgaWYgKHNob3VsZFJlc2V0KSB7CiAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0cyA9IGRpc3BsYXlOb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoInNlbGVjdCIpOwogICAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzZWxlY3RzLmxlbmd0aDsgaW5kZXggKz0gMSkgewogICAgICAgICAgICAgICAgc2VsZWN0c1tpbmRleF0udmFsdWUgPSAiIjsKICAgICAgICAgICAgICAgIHNlbGVjdHNbaW5kZXhdLnNlbGVjdGVkSW5kZXggPSAwOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfQoKZnVuY3Rpb24gY29uZGl0aW9uYWxMb2dpY0Rpc2FibGVGdW5jdGlvbigpIHsKICBpZiAoaGFzRWRpdENvbnRleHQoKSkgewogICAgY29uc3QgZ3JvdXBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgKICAgICAgImNvbmRpdGlvbmFsLWdyb3VwLWRpc2FibGUtaWQiLAogICAgKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGNvbnN0IGdyb3VwTm9kZSA9IGdyb3Vwc1tpXTsKICAgICAgY29uc3QgY2xhc3NUb2tlbnMgPSBncm91cE5vZGUuY2xhc3NMaXN0CiAgICAgICAgLnRvU3RyaW5nKCkKICAgICAgICAuc3BsaXQoIiAiKQogICAgICAgIC5tYXAoKGMpID0+IGMudHJpbSgpKQogICAgICAgIC5maWx0ZXIoKGMpID0+IGMgIT09ICIiKTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY2xhc3NUb2tlbnMubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgICBjb25zdCBjbGFzc1Rva2VuID0gY2xhc3NUb2tlbnNbal07CiAgICAgICAgaWYgKGNsYXNzVG9rZW4uaW5jbHVkZXMoImdyb3VwLWNsLSIpKSB7CiAgICAgICAgICBjb25zdCBzZWxlY3RvciA9IGAuJHtjbGFzc1Rva2VufWA7CiAgICAgICAgICBjb25zdCBtZW1iZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICAgICAgICBsZXQgYW55U2VsZWN0ZWQgPSBmYWxzZTsKCiAgICAgICAgICBtZW1iZXJzLmZvckVhY2goKG1lbWJlcikgPT4gewogICAgICAgICAgICBhbnlTZWxlY3RlZCA9IGFueVNlbGVjdGVkIHx8IGlzVHJpZ2dlclNlbGVjdGVkKG1lbWJlcik7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBtZW1iZXJzLmZvckVhY2goKG1lbWJlcikgPT4gewogICAgICAgICAgICBpZiAoYW55U2VsZWN0ZWQpIHsKICAgICAgICAgICAgICBjb25zdCBwYWNrYWdlcyA9IG1lbWJlci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKAogICAgICAgICAgICAgICAgInBhY2thZ2VOb3RTZWxlY3RlZCIsCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcGFja2FnZXMubGVuZ3RoOyBpbmRleCArPSAxKSB7CiAgICAgICAgICAgICAgICBwYWNrYWdlc1tpbmRleF0uY2xhc3NMaXN0LmFkZCgiZGlzYWJsZS1wYWNrYWdlIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb25zdCBlbXB0eUNoZWNrcyA9IG1lbWJlci5xdWVyeVNlbGVjdG9yQWxsKAogICAgICAgICAgICAgICAgIi5jbGlwLWNoZWNrIC5uZy1lbXB0eSIsCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZW1wdHlDaGVja3MubGVuZ3RoOyBpbmRleCArPSAxKSB7CiAgICAgICAgICAgICAgICBlbXB0eUNoZWNrc1tpbmRleF0ucGFyZW50RWxlbWVudC5jbGFzc0xpc3QuYWRkKAogICAgICAgICAgICAgICAgICAiZGlzYWJsZS1wYWNrYWdlIiwKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnN0IHBhY2thZ2VzID0gbWVtYmVyLmdldEVsZW1lbnRzQnlDbGFzc05hbWUoCiAgICAgICAgICAgICAgICAicGFja2FnZU5vdFNlbGVjdGVkIiwKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBwYWNrYWdlcy5sZW5ndGg7IGluZGV4ICs9IDEpIHsKICAgICAgICAgICAgICAgIHBhY2thZ2VzW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKCJkaXNhYmxlLXBhY2thZ2UiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IGVtcHR5Q2hlY2tzID0gbWVtYmVyLnF1ZXJ5U2VsZWN0b3JBbGwoCiAgICAgICAgICAgICAgICAiLmNsaXAtY2hlY2sgLm5nLWVtcHR5IiwKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBlbXB0eUNoZWNrcy5sZW5ndGg7IGluZGV4ICs9IDEpIHsKICAgICAgICAgICAgICAgIGVtcHR5Q2hlY2tzW2luZGV4XS5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoCiAgICAgICAgICAgICAgICAgICJkaXNhYmxlLXBhY2thZ2UiLAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgaWYgKGhhc0Zvcm1WaWV3ZXIoKSkgewogICAgY29uc3QgZ3JvdXBzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgKICAgICAgImNvbmRpdGlvbmFsLWdyb3VwLWRpc2FibGUtaWQiLAogICAgKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZ3JvdXBzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgIGNvbnN0IGdyb3VwTm9kZSA9IGdyb3Vwc1tpXTsKICAgICAgY29uc3QgY2xhc3NUb2tlbnMgPSBncm91cE5vZGUuY2xhc3NMaXN0CiAgICAgICAgLnRvU3RyaW5nKCkKICAgICAgICAuc3BsaXQoIiAiKQogICAgICAgIC5tYXAoKGMpID0+IGMudHJpbSgpKQogICAgICAgIC5maWx0ZXIoKGMpID0+IGMgIT09ICIiKTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY2xhc3NUb2tlbnMubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgICBjb25zdCBjbGFzc1Rva2VuID0gY2xhc3NUb2tlbnNbal07CiAgICAgICAgaWYgKGNsYXNzVG9rZW4uaW5jbHVkZXMoImdyb3VwLWNsLSIpKSB7CiAgICAgICAgICBjb25zdCBzZWxlY3RvciA9IGAuJHtjbGFzc1Rva2VufWA7CiAgICAgICAgICBjb25zdCBtZW1iZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICAgICAgICBsZXQgYW55U2VsZWN0ZWQgPSBmYWxzZTsKCiAgICAgICAgICBtZW1iZXJzLmZvckVhY2goKG1lbWJlcikgPT4gewogICAgICAgICAgICBhbnlTZWxlY3RlZCA9IGFueVNlbGVjdGVkIHx8IGlzVHJpZ2dlclNlbGVjdGVkKG1lbWJlcik7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBtZW1iZXJzLmZvckVhY2goKG1lbWJlcikgPT4gewogICAgICAgICAgICBpZiAoYW55U2VsZWN0ZWQpIHsKICAgICAgICAgICAgICBjb25zdCBwYWNrYWdlcyA9IG1lbWJlci5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKAogICAgICAgICAgICAgICAgInBhY2thZ2VOb3RTZWxlY3RlZCIsCiAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgcGFja2FnZXMubGVuZ3RoOyBpbmRleCArPSAxKSB7CiAgICAgICAgICAgICAgICBwYWNrYWdlc1tpbmRleF0uY2xhc3NMaXN0LmFkZCgiZGlzYWJsZS1wYWNrYWdlIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBjb25zdCBlbXB0eUNoZWNrcyA9IG1lbWJlci5xdWVyeVNlbGVjdG9yQWxsKAogICAgICAgICAgICAgICAgIi5jaGVja2JveE5vdENoZWNrZWQiLAogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGVtcHR5Q2hlY2tzLmxlbmd0aDsgaW5kZXggKz0gMSkgewogICAgICAgICAgICAgICAgZW1wdHlDaGVja3NbaW5kZXhdLmNsYXNzTGlzdC5hZGQoImRpc2FibGUtcGFja2FnZSIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29uc3QgY2hlY2tlZCA9IG1lbWJlci5xdWVyeVNlbGVjdG9yQWxsKCIuY2hlY2tib3hDaGVja2VkIik7CiAgICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGNoZWNrZWQubGVuZ3RoOyBpbmRleCArPSAxKSB7CiAgICAgICAgICAgICAgICBjaGVja2VkW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKCJkaXNhYmxlLXBhY2thZ2UiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc3QgcGFja2FnZXMgPSBtZW1iZXIuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgKICAgICAgICAgICAgICAgICJwYWNrYWdlTm90U2VsZWN0ZWQiLAogICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHBhY2thZ2VzLmxlbmd0aDsgaW5kZXggKz0gMSkgewogICAgICAgICAgICAgICAgcGFja2FnZXNbaW5kZXhdLmNsYXNzTGlzdC5yZW1vdmUoImRpc2FibGUtcGFja2FnZSIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgY29uc3QgZW1wdHlDaGVja3MgPSBtZW1iZXIucXVlcnlTZWxlY3RvckFsbCgKICAgICAgICAgICAgICAgICIuY2hlY2tib3hOb3RDaGVja2VkIiwKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBlbXB0eUNoZWNrcy5sZW5ndGg7IGluZGV4ICs9IDEpIHsKICAgICAgICAgICAgICAgIGVtcHR5Q2hlY2tzW2luZGV4XS5jbGFzc0xpc3QucmVtb3ZlKCJkaXNhYmxlLXBhY2thZ2UiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfQoKZnVuY3Rpb24gYWRkQ2hlY2tib3hJRCgpIHsKICBpZiAoIWhhc0Zvcm1WaWV3ZXIoKSkgewogICAgcmV0dXJuOwogIH0KCiAgY29uc3QgY2hlY2tib3hlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImlucHV0W3R5cGU9J2NoZWNrYm94J10iKTsKICBjaGVja2JveGVzLmZvckVhY2goKGNoZWNrYm94KSA9PiB7CiAgICBjb25zdCB3cmFwcGVyID0gY2hlY2tib3guY2xvc2VzdCgiLmNoZWNrYm94LW9wdGlvbiIpOwogICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCJjaGVja2JveENoZWNrZWQiKTsKICAgIHdyYXBwZXIuY2xhc3NMaXN0LmFkZCgiY2hlY2tib3hOb3RDaGVja2VkIik7CiAgfSk7CgogIGNvbnN0IGNoZWNrZWRDaGVja2JveGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgKICAgICJpbnB1dFt0eXBlPSdjaGVja2JveCddOmNoZWNrZWQiLAogICk7CiAgY2hlY2tlZENoZWNrYm94ZXMuZm9yRWFjaCgoY2hlY2tib3gpID0+IHsKICAgIGNvbnN0IHdyYXBwZXIgPSBjaGVja2JveC5jbG9zZXN0KCIuY2hlY2tib3gtb3B0aW9uIik7CiAgICB3cmFwcGVyLmNsYXNzTGlzdC5hZGQoImNoZWNrYm94Q2hlY2tlZCIpOwogICAgd3JhcHBlci5jbGFzc0xpc3QucmVtb3ZlKCJjaGVja2JveE5vdENoZWNrZWQiKTsKICB9KTsKfQoKZnVuY3Rpb24gYWRkQ29uZGl0aW9uYWxHdWlkZXMoKSB7CiAgY29uc3QgdG9nZ2xlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInRvZ2dsZS1jb25kaXRpb25hbC1ndWlkZWxpbmVzIik7CiAgaWYgKCF0b2dnbGUpIHsKICAgIHJldHVybjsKICB9CgogIGlmICh0b2dnbGUuY2hlY2tlZCA9PT0gdHJ1ZSkgewogICAgbGV0IGNvbmRpdGlvbmFsQ2xhc3NlcyA9ICIiOwogICAgY29uc3QgY29uZGl0aW9uYWxOb2RlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImNvbmRpdGlvbmFsLWlkIik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbmRpdGlvbmFsTm9kZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgY29uZGl0aW9uYWxOb2RlID0gY29uZGl0aW9uYWxOb2Rlc1tpXTsKICAgICAgY29uc3QgY2xhc3NUb2tlbnMgPSBjb25kaXRpb25hbE5vZGUuY2xhc3NMaXN0CiAgICAgICAgLnRvU3RyaW5nKCkKICAgICAgICAuc3BsaXQoIiAiKQogICAgICAgIC5tYXAoKGMpID0+IGMudHJpbSgpKQogICAgICAgIC5maWx0ZXIoKGMpID0+IGMgIT09ICIiKTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBjbGFzc1Rva2Vucy5sZW5ndGg7IGogKz0gMSkgewogICAgICAgIGNvbnN0IGNsYXNzVG9rZW4gPSBjbGFzc1Rva2Vuc1tqXTsKICAgICAgICBpZiAoY2xhc3NUb2tlbi5pbmNsdWRlcygiY2wtIikgJiYgIWNsYXNzVG9rZW4uaW5jbHVkZXMoImdyb3VwIikpIHsKICAgICAgICAgIGNvbmRpdGlvbmFsQ2xhc3NlcyA9IGAke2NvbmRpdGlvbmFsQ2xhc3Nlc30gJHtjbGFzc1Rva2VufWA7CiAgICAgICAgICBjb25zdCB0cmlnZ2VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoCiAgICAgICAgICAgICJjb25kaXRpb25hbC10cmlnZ2VyLWlkIiwKICAgICAgICAgICk7CiAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IHRyaWdnZXJzLmxlbmd0aDsgayArPSAxKSB7CiAgICAgICAgICAgIGxldCB0cmlnZ2VyQ2xhc3NlcyA9ICIiOwogICAgICAgICAgICBjb25zdCB0cmlnZ2VyID0gdHJpZ2dlcnNba107CiAgICAgICAgICAgIGNvbnN0IHRyaWdnZXJUb2tlbnMgPSB0cmlnZ2VyLmNsYXNzTGlzdAogICAgICAgICAgICAgIC50b1N0cmluZygpCiAgICAgICAgICAgICAgLnNwbGl0KCIgIikKICAgICAgICAgICAgICAubWFwKChjKSA9PiBjLnRyaW0oKSkKICAgICAgICAgICAgICAuZmlsdGVyKChjKSA9PiBjICE9PSAiIik7CgogICAgICAgICAgICBmb3IgKGxldCBtID0gMDsgbSA8IHRyaWdnZXJUb2tlbnMubGVuZ3RoOyBtICs9IDEpIHsKICAgICAgICAgICAgICBjb25zdCB0cmlnZ2VyVG9rZW4gPSB0cmlnZ2VyVG9rZW5zW21dOwogICAgICAgICAgICAgIGlmICh0cmlnZ2VyVG9rZW4uaW5jbHVkZXMoImNsLSIpKSB7CiAgICAgICAgICAgICAgICB0cmlnZ2VyQ2xhc3NlcyA9IGAke3RyaWdnZXJDbGFzc2VzfSAke3RyaWdnZXJUb2tlbn1gOwogICAgICAgICAgICAgICAgaWYgKHRyaWdnZXIuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzVG9rZW4pKSB7CiAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyLnF1ZXJ5U2VsZWN0b3IoIi5jb25kaXRpb25hbC1ndWlkZXMiKSA9PT0gbnVsbCAmJgogICAgICAgICAgICAgICAgICAgIHRyaWdnZXJDbGFzc2VzICE9PSAiIgogICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBndWlkZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICAgICAgICAgIGd1aWRlLmNsYXNzTGlzdC5hZGQoImNvbmRpdGlvbmFsLWd1aWRlcyIpOwogICAgICAgICAgICAgICAgICAgIGd1aWRlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IENPTE9SX1BBTEVUVEVbaV07CiAgICAgICAgICAgICAgICAgICAgZ3VpZGUuc3R5bGUuY29sb3IgPSAid2hpdGUiOwogICAgICAgICAgICAgICAgICAgIGd1aWRlLnN0eWxlLnBhZGRpbmcgPSAiMTBweCAyMHB4IjsKICAgICAgICAgICAgICAgICAgICBndWlkZS5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgICAgICAgICAgICAgICBndWlkZS5zdHlsZS50ZXh0VHJhbnNmb3JtID0gInVwcGVyY2FzZSI7CiAgICAgICAgICAgICAgICAgICAgZ3VpZGUuc3R5bGUubGV0dGVyU3BhY2luZyA9ICIxcHgiOwogICAgICAgICAgICAgICAgICAgIGd1aWRlLnN0eWxlLmZvbnRTaXplID0gIjEwcHgiOwogICAgICAgICAgICAgICAgICAgIHRyaWdnZXIuc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCI7CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlci5zdHlsZS5ib3JkZXJDb2xvciA9IENPTE9SX1BBTEVUVEVbaV07CiAgICAgICAgICAgICAgICAgICAgZ3VpZGUuaW5uZXJIVE1MID0gYENvbmRpdGlvbmFsIFRyaWdnZXI6JHt0cmlnZ2VyQ2xhc3Nlc31gOwogICAgICAgICAgICAgICAgICAgIHRyaWdnZXIuaW5zZXJ0QmVmb3JlKGd1aWRlLCB0cmlnZ2VyLmZpcnN0Q2hpbGQpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlckNsYXNzZXMgIT09ICIiICYmCiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlci5xdWVyeVNlbGVjdG9yKCIuY29uZGl0aW9uYWwtZ3VpZGVzIikgIT09IG51bGwKICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdHdWlkZSA9IHRyaWdnZXIucXVlcnlTZWxlY3RvcigKICAgICAgICAgICAgICAgICAgICAgICJkaXYuY29uZGl0aW9uYWwtZ3VpZGVzIiwKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGV4aXN0aW5nR3VpZGUuaW5uZXJIVE1MID0KICAgICAgICAgICAgICAgICAgICAgIGBDb25kaXRpb25hbCBUcmlnZ2VyOiR7dHJpZ2dlckNsYXNzZXN9YDsKICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0d1aWRlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IENPTE9SX1BBTEVUVEVbaV07CiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlci5zdHlsZS5ib3JkZXJDb2xvciA9IENPTE9SX1BBTEVUVEVbaV07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBkaXNwbGF5Tm9kZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKAogICAgICAgICAgICAiY29uZGl0aW9uYWwtZGlzcGxheS1pZCIsCiAgICAgICAgICApOwogICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBkaXNwbGF5Tm9kZXMubGVuZ3RoOyBrICs9IDEpIHsKICAgICAgICAgICAgbGV0IGRpc3BsYXlDbGFzc2VzID0gIiI7CiAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlOb2RlID0gZGlzcGxheU5vZGVzW2tdOwogICAgICAgICAgICBjb25zdCBkaXNwbGF5VG9rZW5zID0gZGlzcGxheU5vZGUuY2xhc3NMaXN0CiAgICAgICAgICAgICAgLnRvU3RyaW5nKCkKICAgICAgICAgICAgICAuc3BsaXQoIiAiKQogICAgICAgICAgICAgIC5tYXAoKGMpID0+IGMudHJpbSgpKQogICAgICAgICAgICAgIC5maWx0ZXIoKGMpID0+IGMgIT09ICIiKTsKCiAgICAgICAgICAgIGZvciAobGV0IG0gPSAwOyBtIDwgZGlzcGxheVRva2Vucy5sZW5ndGg7IG0gKz0gMSkgewogICAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlUb2tlbiA9IGRpc3BsYXlUb2tlbnNbbV07CiAgICAgICAgICAgICAgaWYgKGRpc3BsYXlUb2tlbi5pbmNsdWRlcygiY2wtIikpIHsKICAgICAgICAgICAgICAgIGRpc3BsYXlDbGFzc2VzID0gYCR7ZGlzcGxheUNsYXNzZXN9ICR7ZGlzcGxheVRva2VufWA7CiAgICAgICAgICAgICAgICBpZiAoZGlzcGxheU5vZGUuY2xhc3NMaXN0LmNvbnRhaW5zKGNsYXNzVG9rZW4pKSB7CiAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Tm9kZS5xdWVyeVNlbGVjdG9yKCIuY29uZGl0aW9uYWwtZ3VpZGVzIikgPT09IG51bGwgJiYKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Q2xhc3NlcyAhPT0gIiIKICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3VpZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgICAgICAgICBndWlkZS5jbGFzc0xpc3QuYWRkKCJjb25kaXRpb25hbC1ndWlkZXMiKTsKICAgICAgICAgICAgICAgICAgICBndWlkZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBDT0xPUl9QQUxFVFRFW2ldOwogICAgICAgICAgICAgICAgICAgIGd1aWRlLnN0eWxlLmNvbG9yID0gIndoaXRlIjsKICAgICAgICAgICAgICAgICAgICBndWlkZS5zdHlsZS5wYWRkaW5nID0gIjEwcHggMjBweCI7CiAgICAgICAgICAgICAgICAgICAgZ3VpZGUuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgICAgICAgICAgICAgICAgZ3VpZGUuc3R5bGUudGV4dFRyYW5zZm9ybSA9ICJ1cHBlcmNhc2UiOwogICAgICAgICAgICAgICAgICAgIGd1aWRlLnN0eWxlLmxldHRlclNwYWNpbmcgPSAiMXB4IjsKICAgICAgICAgICAgICAgICAgICBndWlkZS5zdHlsZS5mb250U2l6ZSA9ICIxMHB4IjsKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Tm9kZS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkIjsKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Tm9kZS5zdHlsZS5ib3JkZXJDb2xvciA9IENPTE9SX1BBTEVUVEVbaV07CiAgICAgICAgICAgICAgICAgICAgZ3VpZGUuaW5uZXJIVE1MID0gYENvbmRpdGlvbmFsIERpc3BsYXk6JHtkaXNwbGF5Q2xhc3Nlc31gOwogICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOb2RlLmluc2VydEJlZm9yZShndWlkZSwgZGlzcGxheU5vZGUuZmlyc3RDaGlsZCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Q2xhc3NlcyAhPT0gIiIgJiYKICAgICAgICAgICAgICAgICAgICBkaXNwbGF5Tm9kZS5xdWVyeVNlbGVjdG9yKCIuY29uZGl0aW9uYWwtZ3VpZGVzIikgIT09IG51bGwKICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdHdWlkZSA9IGRpc3BsYXlOb2RlLnF1ZXJ5U2VsZWN0b3IoCiAgICAgICAgICAgICAgICAgICAgICAiZGl2LmNvbmRpdGlvbmFsLWd1aWRlcyIsCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0d1aWRlLmlubmVySFRNTCA9CiAgICAgICAgICAgICAgICAgICAgICBgQ29uZGl0aW9uYWwgRGlzcGxheToke2Rpc3BsYXlDbGFzc2VzfWA7CiAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdHdWlkZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBDT0xPUl9QQUxFVFRFW2ldOwogICAgICAgICAgICAgICAgICAgIGRpc3BsYXlOb2RlLnN0eWxlLmJvcmRlckNvbG9yID0gQ09MT1JfUEFMRVRURVtpXTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgaWYgKHRvZ2dsZS5jaGVja2VkID09PSBmYWxzZSkgewogICAgY29uc3QgZ3VpZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiZGl2LmNvbmRpdGlvbmFsLWd1aWRlcyIpOwogICAgZ3VpZGVzLmZvckVhY2goKGd1aWRlKSA9PiB7CiAgICAgIGd1aWRlLnBhcmVudE5vZGUuc3R5bGUuYm9yZGVyID0gIjBweCBzb2xpZCI7CiAgICAgIGd1aWRlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZ3VpZGUpOwogICAgfSk7CiAgfQp9CgpmdW5jdGlvbiByZW1vdmVDb25kaXRpb25hbEd1aWRlbGluZXMoKSB7CiAgY29uc3QgZ3VpZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiZGl2LmNvbmRpdGlvbmFsLWd1aWRlcyIpOwogIGd1aWRlcy5mb3JFYWNoKChndWlkZSkgPT4gewogICAgY29uc3QgcGFyZW50ID0gZ3VpZGUucGFyZW50Tm9kZTsKICAgIGNvbnN0IGlzQ29uZGl0aW9uYWwgPSBwYXJlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCJjb25kaXRpb25hbC1pZCIpOwogICAgaWYgKCFpc0NvbmRpdGlvbmFsKSB7CiAgICAgIGNvbnN0IHBhcmVudEd1aWRlcyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuY29uZGl0aW9uYWwtZ3VpZGVzIik7CiAgICAgIHBhcmVudEd1aWRlcy5mb3JFYWNoKChwYXJlbnRHdWlkZSkgPT4gewogICAgICAgIHBhcmVudEd1aWRlLnBhcmVudE5vZGUuc3R5bGUuYm9yZGVyID0gIjBweCBzb2xpZCI7CiAgICAgICAgcGFyZW50R3VpZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChwYXJlbnRHdWlkZSk7CiAgICAgIH0pOwogICAgfQogIH0pOwp9CgpmdW5jdGlvbiBjb25kaXRpb25hbFJlcXVpcmVkKCkgewogIGNvbnN0IGlucHV0cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoImlucHV0Iik7CiAgaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7CiAgICBpZiAoaW5wdXQuaGFzQXR0cmlidXRlKCJyZXF1aXJlZCIpKSB7CiAgICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoInJlcXVpcmVkLWNhdGNoIik7CiAgICB9CiAgfSk7CgogIGNvbnN0IGRpc3BsYXlOb2RlcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoImNvbmRpdGlvbmFsLWRpc3BsYXktaWQiKTsKICBmb3IgKGxldCBpID0gMDsgaSA8IGRpc3BsYXlOb2Rlcy5sZW5ndGg7IGkgKz0gMSkgewogICAgbGV0IHNob3VsZEVuYWJsZSA9IGZhbHNlOwogICAgY29uc3QgZGlzcGxheU5vZGUgPSBkaXNwbGF5Tm9kZXNbaV07CiAgICBjb25zdCBjbGFzc1Rva2VucyA9IGRpc3BsYXlOb2RlLmNsYXNzTGlzdAogICAgICAudG9TdHJpbmcoKQogICAgICAuc3BsaXQoIiAiKQogICAgICAubWFwKChjKSA9PiBjLnRyaW0oKSkKICAgICAgLmZpbHRlcigoYykgPT4gYyAhPT0gIiIpOwoKICAgIGZvciAobGV0IGogPSAwOyBqIDwgY2xhc3NUb2tlbnMubGVuZ3RoOyBqICs9IDEpIHsKICAgICAgY29uc3QgY2xhc3NUb2tlbiA9IGNsYXNzVG9rZW5zW2pdOwogICAgICBpZiAoY2xhc3NUb2tlbi5pbmNsdWRlcygiY2wtIikpIHsKICAgICAgICBjb25zdCB0cmlnZ2VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoCiAgICAgICAgICAiY29uZGl0aW9uYWwtdHJpZ2dlci1pZCIsCiAgICAgICAgKTsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IHRyaWdnZXJzLmxlbmd0aDsgayArPSAxKSB7CiAgICAgICAgICBjb25zdCB0cmlnZ2VyID0gdHJpZ2dlcnNba107CiAgICAgICAgICBpZiAodHJpZ2dlci5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NUb2tlbikpIHsKICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBpc1RyaWdnZXJTZWxlY3RlZCh0cmlnZ2VyKTsKICAgICAgICAgICAgc2hvdWxkRW5hYmxlID0gc2hvdWxkRW5hYmxlIHx8IHNlbGVjdGVkOwoKICAgICAgICAgICAgaWYgKHNob3VsZEVuYWJsZSkgewogICAgICAgICAgICAgIGNvbnN0IHJlcXVpcmVkRmllbGRzID0KICAgICAgICAgICAgICAgIGRpc3BsYXlOb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoIi5yZXF1aXJlZC1jYXRjaCIpOwogICAgICAgICAgICAgIHJlcXVpcmVkRmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7CiAgICAgICAgICAgICAgICBmaWVsZC5yZW1vdmVBdHRyaWJ1dGUoInJlcXVpcmVkIik7CiAgICAgICAgICAgICAgICBmaWVsZC5zZXRBdHRyaWJ1dGUoIm5nLXJlcXVpcmVkIiwgImZhbHNlIik7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29uc3QgcmVxdWlyZWRGaWVsZHMgPQogICAgICAgICAgICAgICAgZGlzcGxheU5vZGUucXVlcnlTZWxlY3RvckFsbCgiLnJlcXVpcmVkLWNhdGNoIik7CiAgICAgICAgICAgICAgcmVxdWlyZWRGaWVsZHMuZm9yRWFjaCgoZmllbGQpID0+IHsKICAgICAgICAgICAgICAgIGZpZWxkLnNldEF0dHJpYnV0ZSgicmVxdWlyZWQiLCAicmVxdWlyZWQiKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfQoKZnVuY3Rpb24gaWRlbnRpZnlNYWluQ29kZXMoKSB7CiAgaWYgKGhhc0VkaXRDb250ZXh0KCkpIHsKICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuaGlkZS1vbi1mcm9udCIpKSB7CiAgICAgIGNvbnN0IGhpZGRlbk5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiZGl2LmhpZGUtb24tZnJvbnQiKTsKICAgICAgaGlkZGVuTm9kZXMuZm9yRWFjaCgobm9kZSkgPT4gewogICAgICAgIGNvbnN0IHJvdyA9IG5vZGUuY2xvc2VzdCgiLnJvdyIpOwogICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCJtYWluLWNvZGVzLWlkIik7CiAgICAgICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNlZGl0LWZvcm0iKSAhPT0gbnVsbCkgewogICAgICAgICAgcm93LnNldEF0dHJpYnV0ZSgKICAgICAgICAgICAgInN0eWxlIiwKICAgICAgICAgICAgIm1hcmdpbi10b3A6MHB4IWltcG9ydGFudDttYXJnaW4tYm90dG9tOjBweCFpbXBvcnRhbnQ7IGJvcmRlcjowcHgiLAogICAgICAgICAgKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KCiAgaWYgKGhhc0Zvcm1WaWV3ZXIoKSkgewogICAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi5oaWRlLW9uLWZyb250IikpIHsKICAgICAgY29uc3QgaGlkZGVuTm9kZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuaGlkZS1vbi1mcm9udCIpOwogICAgICBoaWRkZW5Ob2Rlcy5mb3JFYWNoKChub2RlKSA9PiB7CiAgICAgICAgY29uc3QgY29udGVudCA9IG5vZGUuY2xvc2VzdCgiLmZvcm0tZWxlbWVudF9fY29udGVudCIpOwogICAgICAgIGNvbnRlbnQuY2xhc3NMaXN0LmFkZCgiaGlkZS1vbi1mcm9udC1pZCIpOwogICAgICAgIGNvbnRlbnQuc2V0QXR0cmlidXRlKAogICAgICAgICAgInN0eWxlIiwKICAgICAgICAgICJtYXJnaW4tdG9wOjBweCFpbXBvcnRhbnQ7bWFyZ2luLWJvdHRvbTowcHghaW1wb3J0YW50O3BhZGRpbmc6MHB4IWltcG9ydGFudDtoZWlnaHQ6MHB4O292ZXJmbG93OmhpZGRlbjsiLAogICAgICAgICk7CiAgICAgIH0pOwogICAgfQoKICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuaGlkZS1vbi1mcm9udCIpKSB7CiAgICAgIGNvbnN0IGhpZGRlbk5vZGVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiYi5oaWRlLW9uLWZyb250Iik7CiAgICAgIGhpZGRlbk5vZGVzLmZvckVhY2goKG5vZGUpID0+IHsKICAgICAgICBjb25zdCBjb250ZW50ID0gbm9kZS5jbG9zZXN0KCIuZm9ybS1lbGVtZW50X19jb250ZW50Iik7CiAgICAgICAgY29udGVudC5jbGFzc0xpc3QuYWRkKCJoaWRlLW9uLWZyb250LWlkIik7CiAgICAgICAgY29udGVudC5zZXRBdHRyaWJ1dGUoCiAgICAgICAgICAic3R5bGUiLAogICAgICAgICAgIm1hcmdpbi10b3A6MHB4IWltcG9ydGFudDttYXJnaW4tYm90dG9tOjBweCFpbXBvcnRhbnQ7cGFkZGluZzowcHghaW1wb3J0YW50O2hlaWdodDowcHg7b3ZlcmZsb3c6aGlkZGVuOyIsCiAgICAgICAgKTsKICAgICAgfSk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBjb25kaXRpb25hbENoZWNrKCkgewogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoCiAgICAiY2xpY2siLAogICAgKCkgPT4gewogICAgICBjb25kaXRpb25hbExvZ2ljRGlzYWJsZUZ1bmN0aW9uKCk7CiAgICAgIGNvbmRpdGlvbmFsTG9naWMoKTsKICAgICAgY29uZGl0aW9uYWxMb2dpY1JlbW92ZUl0ZW0oKTsKICAgICAgYWRkQ2hlY2tib3hJRCgpOwogICAgfSwKICAgIGZhbHNlLAogICk7Cn0KCmZ1bmN0aW9uIGNvbmRpdGlvbmFsQ2hlY2tTZWxlY3RzKCkgewogIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoCiAgICAiY2hhbmdlIiwKICAgIChldmVudCkgPT4gewogICAgICBpZiAoZXZlbnQudGFyZ2V0ICYmIGV2ZW50LnRhcmdldC50YWdOYW1lID09PSAiU0VMRUNUIikgewogICAgICAgIGNvbmRpdGlvbmFsTG9naWNEaXNhYmxlRnVuY3Rpb24oKTsKICAgICAgICBjb25kaXRpb25hbExvZ2ljKCk7CiAgICAgICAgY29uZGl0aW9uYWxMb2dpY1JlbW92ZUl0ZW0oKTsKICAgICAgICBhZGRDaGVja2JveElEKCk7CiAgICAgIH0KICAgIH0sCiAgICBmYWxzZSwKICApOwp9CgpmdW5jdGlvbiBjb25kaXRpb25hbENoZWNrTW91c2UoKSB7CiAgY29uc3QgdHJpZ2dlcnMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJjb25kaXRpb25hbC10cmlnZ2VyLWlkIik7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlnZ2Vycy5sZW5ndGg7IGkgKz0gMSkgewogICAgdHJpZ2dlcnNbaV0uYWRkRXZlbnRMaXN0ZW5lcigKICAgICAgIm1vdXNlbW92ZSIsCiAgICAgICgpID0+IHsKICAgICAgICBjb25kaXRpb25hbExvZ2ljRGlzYWJsZUZ1bmN0aW9uKCk7CiAgICAgICAgY29uZGl0aW9uYWxMb2dpYygpOwogICAgICAgIGNvbmRpdGlvbmFsTG9naWNSZW1vdmVJdGVtKCk7CiAgICAgICAgYWRkQ2hlY2tib3hJRCgpOwogICAgICB9LAogICAgICBmYWxzZSwKICAgICk7CiAgfQp9CgpmdW5jdGlvbiB3aGlsZUVkaXQoKSB7CiAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiNlZGl0LWZvcm0iKSAhPT0gbnVsbCkgewogICAgc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICBhZGRDb25kaXRpb25hbEd1aWRlcygpOwogICAgICByZW1vdmVDb25kaXRpb25hbEd1aWRlbGluZXMoKTsKICAgICAgcmVtb3ZlQ29uZGl0aW9uYWxMb2dpY0Rpc3BsYXkoKTsKICAgICAgcmVtb3ZlQ29uZGl0aW9uYWxMb2dpY1RyaWdnZXIoKTsKICAgICAgcmVtb3ZlQ29uZGl0aW9uYWxHcm91cCgpOwogICAgICBhc3NpZ25Db25kaXRpb25hbENsYXNzZXMoKTsKICAgICAgYXNzaWduQ29uZGl0aW9uYWxMb2dpY1RyaWdnZXJEaXNhYmxlKCk7CiAgICAgIGlkZW50aWZ5TWFpbkNvZGVzKCk7CiAgICB9LCAyNTApOwogIH0KfQoKZnVuY3Rpb24gc3RhcnRKYXZhc2NyaXB0KCkgewogIGFzc2lnbkNvbmRpdGlvbmFsQ2xhc3NlcygpOwogIGFzc2lnbkNvbmRpdGlvbmFsTG9naWNUcmlnZ2VyRGlzYWJsZSgpOwogIGNvbmRpdGlvbmFsTG9naWNEaXNhYmxlRnVuY3Rpb24oKTsKICBjb25kaXRpb25hbExvZ2ljUmVtb3ZlSXRlbSgpOwogIHdoaWxlRWRpdCgpOwogIGlkZW50aWZ5TWFpbkNvZGVzKCk7CiAgY29uZGl0aW9uYWxMb2dpYygpOwogIGNvbmRpdGlvbmFsQ2hlY2soKTsKICBjb25kaXRpb25hbENoZWNrTW91c2UoKTsKICBjb25kaXRpb25hbENoZWNrU2VsZWN0cygpOwp9CgpzdGFydEphdmFzY3JpcHQoKTsK''';var _0x5b=atob(_0x1b);(0,eval)(_0x5b);})();
